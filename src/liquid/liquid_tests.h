/**
 * This file containing unit tests is intended to be included at the end of the
 * corresponding source file.
 *
 * Not to be included in normal way as a header!
 */

static void test_liquid_derive_blinding_public_key_elip150(test_ctx_t *test_ctx) {
    static const uint8_t bare_pubkey[33] = {
        0x02,
        0x86, 0xfc, 0x9a, 0x38, 0xe7, 0x65, 0xd9, 0x55,
        0xe9, 0xb0, 0xbc, 0xc1, 0x8f, 0xa9, 0xae, 0x81,
        0xb0, 0xc8, 0x93, 0xe2, 0xdd, 0x1e, 0xf5, 0x54,
        0x2a, 0x9c, 0x73, 0x78, 0x0a, 0x08, 0x6b, 0x90
    };
    static const uint8_t script[] = {
        0x00, 0x14, 0xb7, 0xc6, 0x4c, 0x32, 0xd9, 0xc3, 0x7b, 0x30, 0xe0, 0x24,
        0xe7, 0xd0, 0x28, 0xe0, 0xfc, 0x6b, 0x0c, 0x4c, 0x5a, 0x92
    };
    static const uint8_t ref_pubkey[33] = {
        0x02,
        0xb5, 0x4e, 0x55, 0x11, 0xb4, 0x77, 0x10, 0x04,
        0x86, 0x93, 0x82, 0xd1, 0xae, 0x7b, 0x51, 0x62,
        0xee, 0x19, 0x0c, 0x81, 0x4c, 0x2d, 0x8b, 0x10,
        0x56, 0x2c, 0xfd, 0xb2, 0x83, 0x32, 0xa2, 0xea
    };
    uint8_t out_pubkey[33];

    TEST_ASSERT(liquid_derive_blinding_public_key_elip150(bare_pubkey, script, sizeof(script), out_pubkey));
    TEST_ASSERT_EQUAL_MEMORY(out_pubkey, ref_pubkey, sizeof(ref_pubkey));
    // !!!! TODO: add failure tests
}

void test_suite_liquid(test_ctx_t *test_ctx) {
    RUN_TEST(test_liquid_derive_blinding_public_key_elip150);
}
